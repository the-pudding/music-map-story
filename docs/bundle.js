!function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=2)}([function(t,e,r){(function(e){var r=/^\s+|\s+$/g,n=/^[-+]0x[0-9a-f]+$/i,o=/^0b[01]+$/i,i=/^0o[0-7]+$/i,a=parseInt,l="object"==typeof e&&e&&e.Object===Object&&e,c="object"==typeof self&&self&&self.Object===Object&&self,s=l||c||Function("return this")(),u=Object.prototype.toString,f=Math.max,d=Math.min,b=function(){return s.Date.now()};function p(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function m(t){if("number"==typeof t)return t;if(function(t){return"symbol"==typeof t||function(t){return!!t&&"object"==typeof t}(t)&&"[object Symbol]"==u.call(t)}(t))return NaN;if(p(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=p(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(r,"");var l=o.test(t);return l||i.test(t)?a(t.slice(2),l?2:8):n.test(t)?NaN:+t}t.exports=function(t,e,r){var n,o,i,a,l,c,s=0,u=!1,g=!1,y=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function h(e){var r=n,i=o;return n=o=void 0,s=e,a=t.apply(i,r)}function v(t){return s=t,l=setTimeout(w,e),u?h(t):a}function k(t){var r=t-c;return void 0===c||r>=e||r<0||g&&t-s>=i}function w(){var t=b();if(k(t))return x(t);l=setTimeout(w,function(t){var r=e-(t-c);return g?d(r,i-(t-s)):r}(t))}function x(t){return l=void 0,y&&n?h(t):(n=o=void 0,a)}function P(){var t=b(),r=k(t);if(n=arguments,o=this,c=t,r){if(void 0===l)return v(c);if(g)return l=setTimeout(w,e),h(c)}return void 0===l&&(l=setTimeout(w,e)),a}return e=m(e)||0,p(r)&&(u=!!r.leading,i=(g="maxWait"in r)?f(m(r.maxWait)||0,e):i,y="trailing"in r?!!r.trailing:y),P.cancel=function(){void 0!==l&&clearTimeout(l),s=0,n=c=o=l=void 0},P.flush=function(){return void 0===l?a:x(b())},P}}).call(this,r(1))},function(t,e){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e,r){"use strict";r.r(e);var n=r(0),o=r.n(n);const i={android:()=>navigator.userAgent.match(/Android/i),blackberry:()=>navigator.userAgent.match(/BlackBerry/i),ios:()=>navigator.userAgent.match(/iPhone|iPad|iPod/i),opera:()=>navigator.userAgent.match(/Opera Mini/i),windows:()=>navigator.userAgent.match(/IEMobile/i),any:()=>i.android()||i.blackberry()||i.ios()||i.opera()||i.windows()};var a=i;function l(){(function(t,e=document){return[...e.querySelectorAll(t)]})("[target='_blank']").forEach(t=>t.setAttribute("rel","noopener"))}d3.select("body");var c={init:function(){console.log("Make something awesome!")},resize:function(){}};var s={testing:"This is localhost testing data",city:"Lee",country:"US",hostname:"cpe-74-76-154-164.nycap.res.rr.com",ip:"74.76.154.164",loc:"42.3043,-73.2482",org:"AS11351 Charter Communications Inc",postal:"01238",region:"Massachusetts",timezone:"America/New_York"};function u(){if(window.location.href.includes("localhost"))return Promise.resolve(s);return new Promise((t,e)=>{fetch("https://ipinfo.io?token=6f0f9c88db028a").then(r=>{r.ok?r.json().then(t).catch(e):e(new Error(r.status))})})}var f={init:async function(){return new Promise((t,e)=>{const r=setTimeout(()=>e(new Error("timeout")),4e3);u().then(e=>{clearTimeout(r),t(e)}).catch(e)})},lookup:u};function d(t){return t*Math.PI/180}function b(t,e,r,n){t=d(t),r=d(r),e=d(e);var o=((n=d(n))-e)*Math.cos((t+r)/2),i=r-t;return 6371*Math.sqrt(o*o+i*i)}var p={NearestCity:function(t,e,r){var n,o=99999;for(let a=0;a<r.length;++a){var i=b(t,e,r[a][1],r[a][2]);i<o&&(n=a,o=i)}return r[n][0]},NearestCityDifferent:function(t,e,r,n){var o,i=99999;for(let t=0;t<n.length;++t){var a=b(e,r,n[t][1],n[t][2]);a<i&&(o=t,i=a)}return n[o][0]}};function m(t){return new Promise((e,r)=>{const n=t.split(".").pop();"csv"===n?d3.csv("assets/data/"+t).then(e).catch(r):"json"===n?d3.json("assets/data/"+t).then(e).catch(r):r(new Error("unsupported file type for: "+t))})}var g={init:function(t,e,r,n){let o=new mapboxgl.Map({container:t,center:e,zoom:5,style:"mapbox://styles/dock4242/cklmjep7w2iiq17pc523q7h8j",hash:!1,attributionControl:!1});o.on("load",(function(){o.scrollZoom.disable(),o.setFilter("dots",["all",["match",["get","track_name"],[n],!0,!1]]),o.setFilter("dot-labels",["all",["match",["get","track_name"],[n],!0,!1]]),o.setPaintProperty("dots","circle-stroke-color",r),o.setPaintProperty("dots","circle-color",r),o.setPaintProperty("dot-labels","text-color",r),o.setLayoutProperty("dots","visibility","visible"),o.setLayoutProperty("dot-labels","visibility","visible")}))},fullMap:function(t,e,r){let n=new mapboxgl.Map({container:t,center:e,zoom:3,style:"mapbox://styles/dock4242/cklmjep7w2iiq17pc523q7h8j",hash:!1,attributionControl:!1});var o=[{line:"red",fill:"rgb(20,255,56)",label:"rgb(45,98,53)"},{line:"red",fill:"rgb(130,20,255)",label:"rgb(88,29,154)"},{line:"red",fill:"rgb(0,34,255)",label:"rgb(57,113,154)"},{line:"red",fill:"rgb(255,0,0)",label:"rgb(143,10,10)"},{line:"red",fill:"rgb(255,153,20)",label:"rgb(236,135,4)"},{line:"red",fill:"rgb(255,20,196)",label:"rgb(193,31,153)"},{line:"red",fill:"rgb(255,192,20)",label:"rgb(170,131,24)"},{line:"red",fill:"rgb(179,19,190)",label:"rgb(171,17,182)"},{line:"red",fill:"rgb(255,235,20)",label:"rgb(171,17,182)"}];o=["#ff7f0e","#9467bd","#98df8a","#1f77b4","#9edae5","#f7b6d2","#c5b0d5","#d62728","#bcbd22","#ff9896","#dbdb8d","#ffbb78","#2ca02c","#e377c2","#c49c94","#17becf","#8c564b","#aec7e8"].map((function(t){return{label:t,fill:t}}));let i=d3.rollups(r,t=>t.length,t=>t.track_name).sort(([,t],[,e])=>d3.descending(t,e)).map(([t])=>t);var a=o.map((function(t,e){return[i[e],d3.color(t.fill).darker().toString()]})),l=o.map((function(t,e){return[i[e],d3.color(t.fill).darker(2).toString()]}));n.on("load",(function(){n.scrollZoom.disable(),n.setPaintProperty("dots","circle-color",{base:"rgb(29,27,27)",stops:a,type:"categorical",property:"track_name",base:1,default:"rgb(29,27,27)"}),n.setPaintProperty("dots","circle-stroke-color",{base:"rgb(29,27,27)",stops:a,type:"categorical",property:"track_name",base:1,default:"rgb(29,27,27)"}),n.setLayoutProperty("dot-labels","text-field",["to-string",["get","track_name"]]),n.setPaintProperty("dot-labels","text-color",{base:"rgb(29,27,27)",stops:l,type:"categorical",property:"track_name",base:1,default:"rgb(29,27,27)"}),n.setLayoutProperty("dots","visibility","visible"),n.setLayoutProperty("dot-labels","visibility","visible")}))}};const y=d3.select("body");let h=0;function v(){const t=y.node().offsetWidth;h!==t&&(h=t,c.resize())}!async function(){mapboxgl.accessToken="pk.eyJ1IjoiZG9jazQyNDIiLCJhIjoiY2trOXV2MW9zMDExbTJvczFydTkxOTJvMiJ9.7qeHgJkUfxOaWEYtBGNU9w",mapboxgl.setRTLTextPlugin("https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js",null,!0),l(),y.classed("is-mobile",a.any()),window.addEventListener("resize",o()(v,150));let t=(await f.init()).loc.split(","),e=await function(t){if("string"==typeof t)return m(t);const e=t.map(m);return Promise.all(e)}(["202102/city_data.csv","202102/country_data.csv"]).then(t=>t).catch(console.error),r=p.NearestCity(t[0],t[1],e[0].map((function(t,e){return[t,t.latitude,t.longitude]}))),n=p.NearestCity(r.latitude,r.longitude,e[0].filter((function(t){return t.track_link!=r.track_link})).map((function(t,e){return[t,t.latitude,t.longitude]})));d3.select(".your-geo").text(r.geo_name),d3.select(".top-song-in-your-geo").html(`&ldquo;${r.track_name}&rdquo; by ${r.artist_name}`),d3.select(".top-song-in-your-geo-track").text(""+r.track_name),d3.select(".nearby-geo").text(""+n.geo_name),d3.select(".top-song-in-nearby-geo").html(`&ldquo;${n.track_name}&rdquo; by ${n.artist_name}`),g.init(d3.select(".map-one").node(),[r.longitude,r.latitude],"#7f0101",r.track_name),g.init(d3.select(".map-two").node(),[r.longitude,r.latitude],"#017e23",n.track_name),d3.select(".map-one").select(".headline").style("color","#7f0101").html(`Where &ldquo;${r.track_name}&rdquo; by ${r.artist_name} is the most popular song`),d3.select(".map-two").select(".headline").style("color","#017e23").html(`Where &ldquo;${n.track_name}&rdquo; by ${n.artist_name} is the most popular song`),g.fullMap(d3.select(".map-full").node(),[r.longitude,r.latitude],e[0])}()}]);